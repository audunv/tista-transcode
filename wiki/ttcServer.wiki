= Technical Documentation Tista Transcode =

== Server ==

The TTC Server consists of a thin web interface and a sql database. The server is accessed by user applications (CMS etc) and by the TTC Client through the web interface. Direct access to the database may be necessary at regular intervals to remove old entries.

=== Interface ===

Remote procedure calls understood by the server.

==== Add one job ====

{{{
/ttc/jobs/add_one_job?srcuri=file://path/file&format=mp4&vcodec=h.264&acodec=aac&vbitrate=1024&abitrate=128&width=640&height=480
}}}

Requests ttc to transcode the item located at url file://path/file to containerformat mp4 with videoformat h.264, sound format aac etc. Source URL (srcuri) may be file: or http:.

  * srcuri : url to the video that should be transcoded
  * format : requested containerformat, ogg or mp4
  * vcodec : requested videoformat, theora or h.264
  * acodec : requested audioformat vorbis or aac

Note that in the existing implementation, format will overrule vcodec and acodec. format=ogg will always give vcodec =theora and acodec=vorbis. format=mp4 will return vcodec=h.264 and acodec=aac

  * vbitrate : requested videobitrate. If this is not supplied, the transcoder will try to keep the current bitrate from the source video or choose a functioning replacement value.
  * abitrate : requested audiobitrate. If this is not supplied, the transcoder will try to keep the current bitrate from the source video or choose a functioning replacement value.
  * width : requested width. If this is not supplied, the transcoder will try to keep the current width from the source video or choose a functioning replacement value.
  * height : requested height. If this is not supplied,the transcoder will try to keep the current height from the source video or choose a functioning replacement value.
  * imguri : URL, file or http, to a picture in png-format that will be added in front of and in the end of the video document.
  * imgduration : duration in whole seconds of the added image
  * separation = duration in whole seconds of the period of black between the image and the video.

Return: text in application/json-format:

{{{
{
"id" : "xxxxxx...",
"srcURI" : "file://path/file",
"dstURI" : "file://path/file2"
}
}}}

where id is a 32-byte code used to identify the transcoding job in further communication.

Used by CMS.

==== Download ====

{{{
/ttc/jobs/download/xxxxxx...
}}}

Downloads a not yet transcoded video document from ttc server.

Return: File content

Used by ttc client.

==== Upload ====

{{{
/ttc/jobs/upload/xxxxxx...
}}}

Uploads a transcoded video document to the ttc server. The server will recognize the document as the product of a transcoding job identified by the id.

Used by ttc client.

==== Get Job info ====

{{{
/ttc/jobs/get_job_info ? id=xxxxxx...
}}}

Asks for information on a particular transcoding job.

Return: application/json following the pattern:

{{{
{
"id" : "xxxxxx...", 
"state" : "w", 
"srcURI" : "file://path/file",
"dstURI" : "file://path/file2"
"progress" : "0"
}
}}}

where state (w|i|f|e) indicates wether the job Waits in queue, is In progress, is Finished or has Error status. Pogress is the number of bytes written to the result document.

Used by CMS

==== Jobs ====

{{{
/ttc/jobs/
}}}

Returns a html page informing about what the ttc is doing: All jobs and their state.

Used by system administrator.

==== Snapshot ====

{{{
/ttc/jobs/snapshot ? id=xxxxxx...
}}}

Deprecated.

==== Help ====

{{{
/ttc/help
}}}

A short version of this documentation in html.

==== get Job List ====

{{{
/ttc/jobs/get_job_list?format=mp4&vcodec=h.264&acodec=aac&vbitrate=1024&abitrate=128&width=640&height=480
}}}

A list of all jobs in the database that follows certain conditions.

Return: json

{{{
[
{"id": "xxxxxx...", "format": "mp4"}, 
{"id": "xxxxxx...", "format": "ogg"}
]
}}}

Used by: ttc client wanting to do a job

==== Update ====

{{{
/ttc/jobs/update ? id=xxxxxx...&b=nn
}}}

Informing the server about how many bytes has been transcoded for a paricular job.

Used by : ttc client.

==== Assign job ====

{{{
/ttc/jobs/assign_job ? id=xxxxxx...
}}}

Informing the server that a ttc client has grabbed a job from the Waiting list.

Return: json on the form

{{{
{
"srcURI" : "file://path/file",
"dstURI" : "file://path/file2"
}
}}}

where file and file2 are the locations where the client may fetch and store the video document.

Used by : ttc client.

==== Error ====

{{{
/ttc/jobs/error ? id=xxxxxx...
}}}

Informing ttc server that a transcoding job has failed

Used by : ttc client.


==== Error ====

{{{
/ttc/jobs/finish ? id=xxxxxx... 
}}}

Informing ttc server that a transcoding job has terminated without known errors.

Used by : ttc client.